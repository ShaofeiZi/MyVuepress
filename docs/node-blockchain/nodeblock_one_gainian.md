# 区块链核心名词科普

## 哈希
<font color=#1E90FF>哈希我们可以理解为指纹，也就是任意长度的数据通过散列算换变换成为固定长度的数据</font>，关于哈希有几个特点：

+ <font color=#3eaf7c>正向快速</font>：固定的数据每次转换成为的哈希值是固定的
+ <font color=#3eaf7c>逆向困难</font>：由数据装换后的哈希无法计算出原始数据
+ <font color=#3eaf7c>输入敏感</font>：哪怕原始数据只变化了一个字母，哈希值都会发生翻天覆地的变化，基本找不到规律
+ <font color=#3eaf7c>碰撞避免</font>：因为在哈希当中存在明文不一样但是哈希一样的“哈希碰撞”的问题，但是`Sha256`算法复杂度特别高，导致基本不会产生碰撞问题

哈希还有个作用就是做校验，尤其在一些操作系统上应用比较多，比如厂商发布了正版的操作系统，然后对其所有数据做哈希计算，并将哈希值公布在官网，你从任意渠道下载的操作系统都可以做数据校验，用结果和厂商在官网公布的哈希值对比，一样就是正版，不一样就是盗版。同样的道理，校验也会在区块链上进行同样作用的使用。

## 共识算法机制
<font color=#1E90FF>共识说白了就是达成一致</font>，在中心化的时代没有共识的概念，因为只有一方决定。现在达成共识的机制有这么几个措施：

### 1. pow工作量证明
英文是`proof of work`，在比特币世界又经常被称为`POW`。简单来说就是一份证明，用来确认你做过一定量的某种工作。

现实生活当中含有大量的这种工作量证明的案例，比如一本毕业证就可以让你向用人单位证明你大概有什么样的学识；交警通过驾驶证来检验开车的人是否会开车。

在计算机世界里，工作量证明机制在垃圾邮件防范和拒绝服务攻击识别上都有应用，主要用于阻止网络上的恶意攻击。<font color=#1E90FF>比特币系统设计里这是用来设计成挖矿系统</font>。

工作量证明系统可以看成是两个步骤，一个是工作；另一个是对工作的验证。这分别对应两个主体，一个是工作者；另一个是验证者。

<font color=#DD1144>系统约定好工作内容，验证者给出工作量，工作者完成工作量，验证者检验工作量是否达标。工作量证明的设计需要达到：工作者是一定要花费一定的时间才能完成工作，但验证者却可以瞬间完成检验</font>。

比特币的发行是通过挖矿来完成的，全网平均十分钟挖出一个区块，系统就发行12.5BTC（最初是50BTC，每挖出21万个区块奖励就减半，现在经过了两次减半，变成了12.5BTC）奖励给成功挖到区块的矿工。

矿工为了挖到区块必须进行“工作量证明”过程，这个计算的内容包含三个要素：<font color=#9400D3>工作量证明函数</font>、<font color=#9400D3>前一个区块</font>及<font color=#9400D3>难度值</font>。<font color=#1E90FF>工作量证明函数是给出了计算方法，前一个区块是这个函数的参数，难度值决定了这个函数的解题需要的计算工作量</font>。

那比特币系统里的工作量证明的过程就是这样的：
+ <font color=#DD1144>矿工在网络中拿到最新一个区块的头部信息</font>；
+ <font color=#DD1144>将拿到的头部信息作为参数，将nonce值从零开始，去计算其双重SHA256值（SHA256（SHA256（头部信息）））</font>；
+ <font color=#DD1144>如果算出的答案不符合要求，则将nonce值增加一个单位，再算</font>；
+ <font color=#DD1144>直到计算出符合难度目标的答案，就挖到一个区块。也就能拿到比特币系统给它发的12.5BTC的区块奖励</font>。

所以<font color=#9400D3>挖矿的本质就是找到一个使最新区块头部信息的SHA256值满足难度目标值条件的nonce值</font>。就目前来说，每成功挖到一次区块，一个矿工就需要尝试几十亿次的nonce值。

比特币的工作量证明机制明确通过数学的方式给出了“工作内容”、“工作量”，以及评价方式。把“付出劳动”即获得“所有权”，通过数学的方式模拟了出来，这是最公平的一种所有权分发机制。这也是为什么我们说比特币是最公平的货币发行机制。

### 2. POS权益证明
如果说`POW`这种方式更像工地搬砖，那么`POS`权益证明就更像现在资本主义公司化的运转，并不是说谁干的活多谁说的算，而是谁的股份多谁说的算。

而且，工作量证明`POW`工作量很大，让矿工们需要使用大量的能量，这样促进了矿池的产生，让区块链变的更加中心化，而不是去中心化，所以必须找到更好的算法，比工作量证明高效甚至更好，这就是<font color=#9400D3>权益证明（POS）</font>

在2011年，在一个比特币论坛中一位名为QuantumMechanic的用户提出一项技术，他称之为"权益证明(proof-of-stake)"。

基础概念是，让每个人互相竞争挖矿是很浪费的。因此相反的是，<font color=#1E90FF>权益证明通过选举的形式，其中任意节点被随机选择来验证下一个区块</font>。

在这里有一些小的术语区别，<font color=#DD1144>权益证明中没有矿工，但是有验证者(validator)。并不让人们”挖(mine)”新区块 而是"铸造(mint)” 或"制造(forge)”新区块</font>。

<font color=#1E90FF>验证者并不是被完全随机选择的，要成为验证者，节点需要在网络中存入一定数量的货币作为权益，可以将这理解为保证金</font>。

<font color=#3eaf7c>权益的份额大小决定了被选为验证者的几率，从而得以创建下一个区块，这是线性相关的</font>。假设Bob在网络中存入100美元 Alice存入1000美元，那么Alice比Bob有高于10倍的几率选为验证者。

因为这偏袒有钱的一方，似乎不太公平，但事实上这比起工作量证明更公平。对于工作量证明，富人可以很大程度上享受经济实力带来的成果。他们为挖矿设备和电力支付的成本并没有直线上升。相反他们购买的越多，获得的越多。

但是让我们回到权益证明，如果一个节点被选出来验证下一个区块，他将检查当中所有的交易是否有效。如果一切没问题，节点则通过该区块，区块将加到区块链中。作为奖励，该节点可获得当中每个交易费。

那么，我们该如何相信网络中的其他验证者?这里需要用到权益了。如果验证者通过了欺诈性交易，他们将失去一部分权益。<font color=#1E90FF>只要权益高于验证者所获得的交易费，我们就可以信任他们能够很好的完成工作。否则，他们失去的钱比能获得的还多</font>。

因此，工作量证明和权益证明的区别是很明显的。<font color=#DD1144>权益证明的优点就是权益证明不会让每个人都对新区块进行挖矿。因此消耗更少的能量，而且更去中心化，但是缺点也很明显：还是需要挖矿，本质上没有解决商业应用的痛点。而且存在51%的攻击的风险，虽然这个貌似是不可能的</font>。

### 3. DPOS代理权益证明
上面介绍的权益证明算法可以将整个区块链网络理解为一家公司，占比最大的人有更多的机会得到区块；对于小股东来说，能产生区块的可能性很小，只能得到股份带来的分红和收益。

但是在这里介绍的<font color=#DD1144>DPOS委托权益证明能够让每一个人选出可以代表自己利益的人参与到获取区块的争夺中，这样多个小股东就能够通过投票选出自己的代理人，争取自己的利益</font>。

在委托权益证明中，每一个参与者都能够选举任意数量的节点生成下一个区块，得票最多的前M个节点会被选择成为区块的创建者，下一个区块的创建者就会从这样一组当选者中随机选取，除此之外，M的数量也是由整个网络投票决定的，所以可以尽可能地保证网络的去中心化，而且最重要的还是随机选出的，也就是说数量M不确定，M中选取哪一个也不确定，再加上足够多的总量，可以确定几乎是不可操控的。

### 4. 总结
<font color=#9400D3>Pow工作量证明</font>：就是大家熟悉的挖矿，通过与或运算，计算出一个满足规则的随机数，即获得本次记账权，发出本轮需要记录的数据，全网其它节点验证后一起存储；

+ 优点：完全去中心化，节点自由进出；
+ 缺点：目前bitcoin已经吸引全球大部分的算力，其它再用Pow共识机制的区块链应用很难获得相同的算力来保障自身的安全；挖矿造成大量的资源浪费；共识达成的周期较长，不适合商业应用

<font color=#9400D3>Pos权益证明</font>：Pow的一种升级共识机制；根据每个节点所占代币的比例和时间；等比例的降低挖矿难度，从而加快找随机数的速度。

+ 优点：在一定程度上缩短了共识达成的时间
+ 缺点：还是需要挖矿，本质上没有解决商业应用的痛点

<font color=#9400D3>DPos股份授权证明机制</font>：类似于董事会投票，持币者投出一定数量的节点，代理他们进行验证和记账。

+ 优点：大幅缩小参与验证和记账节点的数量，可以达到秒级的共识验证
+ 缺点：整个共识机制还是依赖于代币，很多商业应用是不需要代币存在的

4、Pool验证池，基于传统的分布式一致性技术，加上数据验证机制；是目前行业链大范围在使用的共识机制
优点：不需要代币也可以工作，在成熟的分布式一致性算法（Pasox、Raft）基础上，实现秒级共识验证；
缺点：去中心化程度不如bictoin；更适合多方参与的多中心商业模式。

## 非对称加密
非对称加密算法需要两个密钥：公钥（`public key`）和私钥（`private key`）。<font color=#DD1144>私钥可以推导出公钥，反之则不行</font>。公钥与私钥是一对，<font color=#1E90FF>如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密；如果用私有密钥对数据进行加密，那么只有用对应的公开密钥才能解密。因为加密和解密使用的是两个不同的密钥</font>，所以这种算法叫作非对称加密算法。



### 1. 私钥如何产生
<font color=#DD1144>私钥就是一组随机的数字或者字符</font>，例如在比特币中，共占有256位，这里的256位是二进位的位，也就是256个或0或1的数字，或者我们说是32个字节的数字串。我们生成私钥从根本上来讲就是生成一个随机的32字节的数字串。这里有两个关键点：<font color=#9400D3>随机</font> 和 <font color=#9400D3>32字节</font>。

这里我们就应该知道<font color=#DD1144>私钥的产生是不依赖与网络的，是可以自己生成</font>，比如我以投硬币的方式来决定这256位上的数是0还是1，在我们项目生成自己的私钥时，都是离线的方式生成私钥：即用一个随机数来生成一个32字节的数字串。

### 2. 公钥如何产生
有了私钥后，通过一定的算法，比如椭圆曲线算法，比如RSA算法，在比特币等区块链系统中，都是应用椭圆曲线算法来生成公钥，大家可以理解为用一个公式来根据私钥得到公钥。具体公式是什么，依赖于不同的算法。

在这里，<font color=#DD1144>我们可以看到公、私钥的生成都是离线的，是不依赖与任何网络系统的，这一点至关重要</font>。

### 3. 签名与验签
消息传递的主体有两方：`A`与`B`,现在我们假设`A`有自己的一对公钥与私钥，`A`已经向`B`公布了自己的公钥，在`A`向`B`传输消息的时候，`A`的私钥比如是：`123456`,那么传输的内容要包含：
+ <font color=#9400D3>公钥</font>
+ <font color=#9400D3>消息本身</font>
+ <font color=#9400D3>用自己私钥对这个消息的签名</font>

当`B`收到`A`发来的内容时，根据内容中包含的“消息本身”与“签名”，用`A`的公钥去验证这个“签名”是否有效。至于如何验证，这是算法的事。

### 4. 加密与解密

消息传递的主体有两方：A与B

B向A发送消息，发送的内容只包含一个部分：用A公钥加密后的密文。A在收到消息时，直接用自己的私钥进行解密，得到明文。

在过程1（签名与验签）中是A向B发消息，在过程2（加密与解密）中是B向A发消息，这里一定要注意，如果过程1与过程2的A与B的主体互换的话，那就是B要有一对公私钥，同时把公钥发给A，所有逻辑反向进行即可。

说了许多，非对称加密好像非常好，但是非对称加密也是有自己的不足的，那就是：运算速度慢，加密效率低。

## 拜占庭将军问题-容错

## p2p网络

## 区块

**参考资料**

1. [共识机制——POW(工作量证明)](https://zhuanlan.zhihu.com/p/37653154)
2. [POS 权益证明究竟是什么](https://zhuanlan.zhihu.com/p/35854600)
3. [白话区块链技术 第1讲｜非对称加密](https://mp.weixin.qq.com/s?__biz=MzUxMTM0MTYzOA==&mid=2247485042&idx=2&sn=a3bb53d29b905106b92facd5f0bd8c59&chksm=f974635bce03ea4d6c742cb73e0b713786264300539381748c3ae3b84ba1e17906f0d01e9e0b&scene=21#wechat_redirect)