# 数据库结构设计

一般设计数据库要经历这么几个步骤：<font color=#1E90FF>业务分析</font> -> <font color=#1E90FF>逻辑设计</font> -> <font color=#1E90FF>数据类型</font> -> <font color=#1E90FF>对象命名</font> -> <font color=#1E90FF>建立库表</font>

## 业务分析
+ <font color=#3eaf7c>课程的属性</font>：主标题，副标题，方向，分类，难度，最新，最热，时长，简介，人数，需知，收获，将实名，讲师职位，课程图片，综合评分，内容实用，简洁易懂，逻辑清晰
+ <font color=#3eaf7c>课程列表的属性</font>：章节，小节名，说明，小节时长，章节URL,视频格式
+ <font color=#3eaf7c>讲师的属性</font>：讲师昵称，说明，性别，省，市，职位，说明，经验，积分，关注人数，粉丝人数
+ <font color=#3eaf7c>问答评论属性</font>：类型，标题，内容，关联章节，浏览量，发布事件，用户昵称
+ <font color=#3eaf7c>笔记属性</font>：用户昵称，关联章节，笔记标题，笔记内容，发布时间
+ <font color=#3eaf7c>用户属性</font>：用户昵称，密码，说明，性别，省，市，职位，说明，经验，积分，关注人数，粉丝人数
+ <font color=#3eaf7c>评价的属性</font>：用户，课程主标题，内容，综合评分，内容实用，简洁易懂，逻辑清晰，发布时间

## 逻辑设计
对于一个对象，我们最容易想到的存储方式是<font color=#DD1144>宽表模式</font>，即将对象所有属性存在一个表里，但是宽表模式也有很多问题：
+ <font color=#3eaf7c>数据冗余</font>：相同的数据在一个表中出现多次，占用对象的存储空间
+ <font color=#3eaf7c>数据更新异常</font>：修改一行中某列的值时，同时修改了多行数据
+ <font color=#3eaf7c>数据插入异常</font>：部分数据由于缺失主键信息而无法写入表中
+ <font color=#3eaf7c>数据删除异常</font>：删除某一数据时不得不删除另一数据

当然了，宽表也并非一无是处，<font color=#1E90FF>宽表比较适合于一些配合列存储的数据报表应用</font>

### 1. 设计范式
<font color=#1E90FF>**① 第一范式：表中所有的字段都不可再分**</font>

也就是必须要保持一个正儿八经的二维表的样子，不能在某个列下面在分出三个子列，比如联系方式下面有手机，家庭电话，单位电话等，出现这样的情况，手机，家庭电话，单位电话全部都是单独的一列即可，<font color=#DD1144>违反第一范式的将子列划分为单列即可</font>

<font color=#1E90FF>**② 第二范式：表中必须存在业务主键，并且非主键依赖于全部业务主键**</font>

主键有<font color=#1E90FF>单列主键</font>和<font color=#1E90FF>复合主键</font>，单列主键天生是符合第二范式的，但是复合主键就不一定了，比如复合主键是（哟用户，章节，标题），那么内容和时间就是依赖于这个复合主键的，因为内容和时间和复合主键中的三列都有关系，但是用户积分就不算，因为它只和用户有关系，和复合主键中的章节标题都没有关系，所以必须将其单独踢出去，单独建立一个用户表，将用户和用户积分放入，<font color=#DD1144>即违反第二范式的列，单独剔除，与相关的主键单独形成新表</font>

<font color=#1E90FF>**③ 第三范式：表中的非主键列之间不能相互依赖**</font>

比如在课程表中，有讲师名和讲师职位的信息，但是不能将两者都放在课程表中的单独两列，因为两者存在依赖关系，讲师职位是依赖讲师名的，但不依赖主标题这个主键，所以我们要将讲师职位单独剔除去和讲师名形成一个单独的新表讲师信息表。<font color=#DD1144>即违反第三范式的列只需要将其剔除，和依赖的主键放在单独的新表当中</font>

### 2. 逻辑建模
在我们学习了设计范式后，我们就能根据设计范式对项目进行逻辑建模，但是实际上设计范式还有很多，只不过当前我们只学习了三个，根据项目的不同选择不同设计范式即可

<font color=#1E90FF>**① 课程的属性分表**</font>

<img :src="$withBase('/mysql_two_class_field.png')" alt="课程的属性分表">

+ <font color=#1E90FF>最新</font>这个属性可以通过上线时间计算获取
+ <font color=#1E90FF>最热</font>这个属性可以通过学习人数来计算获得
+ 关于<font color=#DD1144>方向</font>、<font color=#DD1144>分类</font>、<font color=#DD1144>难度</font>这几个属性虽然和课程的主标题有关，但是如果直接放在课程表当中还是会出现之前我们提到的这些插入，更新，删除的异常，所以我们需要将他们放在其他单独的表中

<font color=#1E90FF>**② 课程列表的属性分表**</font>

<img :src="$withBase('/mysql_two_classlist_field.png')" alt="课程列表的属性分表">

+ 首先对于课程列表的属性，章节名和小节名应该是作为一个复合主键，但是<font color=#1E90FF>说明</font>这个属性只和章节名有关系，后面几个属性只和小节名有关系，<font color=#1E90FF>所以如果全放在一个表当中是违反第二范式的设计规范</font>
+ 我们将和<font color=#1E90FF>课程章节名</font>有关的<font color=#1E90FF>说明</font>、<font color=#1E90FF>章节编号</font>全部放在课程章节表中，然后创建一个<font color=#DD1144>课程和章节的联系表</font>
+ 我们将和<font color=#1E90FF>小节名称</font>有关的<font color=#1E90FF>小节视频url</font>、<font color=#1E90FF>视频格式</font>等属性全部放在课程小节表中，然后创建一个<font color=#DD1144>章和小节的联系表</font>
